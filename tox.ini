[tox]
envlist = py36

[testenv]
deps =
    --requirement={toxinidir}/requirements.txt
    --requirement={toxinidir}/dev/requirements.txt
setenv =
    PYTHONHASHSEED=1234
usedevelop = true
passenv = USER
commands =
    pre-commit install -f --install-hooks
    pre-commit run --all-files
    testify -x sandbox -x integration tests

[flake8]
ignore = E501,E265,E241,E704

[testenv:docs]
whitelist_externals=
    dot
    mkdir
commands=
    python tools/state_diagram.py
    mkdir -p docs/images
    dot -Tpng -odocs/images/action.png action.dot
    sphinx-build -b html -d docs/_build docs docs/_build/html

[testenv:example-cluster]
whitelist_externals=docker-compose
commands=
    docker-compose -f example-cluster/docker-compose.yml build playground
    docker-compose -f example-cluster/docker-compose.yml run -p 8089:8089 playground
    docker-compose -f example-cluster/docker-compose.yml down

[testenv:itest]
commands =
    make deb_trusty
    make _itest_trusty
